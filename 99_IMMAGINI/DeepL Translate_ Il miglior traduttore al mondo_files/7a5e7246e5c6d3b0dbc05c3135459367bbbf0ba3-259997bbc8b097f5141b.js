(self.webpackChunk_deepl_gatsby=self.webpackChunk_deepl_gatsby||[]).push([[2338],{18149:function(e,t,n){"use strict";n.d(t,{j:function(){return l}});var r=n(27378),a=n(34681),o=n(49359);let l=e=>{let{textSource:t,textTarget:n,langSource:l,langTarget:s,onHide:i,oldTextareaStyling:c=!1}=e,{t:g}=(0,a.$)("glossary"),u=g("tooltip_highlight_text",{sourceText:"|",targetText:"|"}).split("|"),f="."!==u[2][0];return(0,r.useEffect)(()=>(window.addEventListener("scroll",i),()=>window.removeEventListener("scroll",i)),[i]),r.createElement("div",{id:"targetHighlightTooltip",className:(0,o.Ch)("lmt__glossary_tooltip",!c&&"!relative !block"),"data-testid":"glossary-highlight-tooltip"},r.createElement("span",null,u[0]),r.createElement("span",{className:"columnSource",lang:l},`"${t}"`),r.createElement("span",null,u[1]),r.createElement("span",{className:(0,o.Ch)("columnTarget",f&&"padRight"),lang:s},`"${n}"`),r.createElement("span",null,u[2]))}},9345:function(e,t,n){"use strict";var r=n(19783),a=n.n(r),o=n(61606),l=n(30171),s=n(12574);o.Z.defineType("/translator/common/computedTextLength",["/translator/core/domElements","/translator/core/textareas"],(e,t)=>{let n=(0,l.S3)(s.A.None),r=()=>{let r=t.getSourceText();if(r.length<=0){n(s.A.Short);return}if(r.length>1e3){n(s.A.VeryLong);return}let a=e.sourceEdit,o=window.getComputedStyle(a),l=a.offsetWidth-(parseFloat(o.paddingLeft)||0)-(parseFloat(o.paddingRight)||0),i=0;r.split("\n").forEach(e=>i+=Math.ceil(10*e.length/l+.1)),l>0&&(i<=1?n(s.A.Short):i<=3?n(s.A.Medium):i<=15?n(s.A.Long):n(s.A.VeryLong))};return t.onSourceTextChanged.push(()=>{r()}),window.addEventListener("resize",a()(()=>{r()},300)),r(),{computedTextLength:n,recalculate:r}})},11929:function(e,t,n){"use strict";let r;var a=n(4769),o=n(67974),l=n(61606),s=n(82736),i=n(89550),c=n(89355),g=n(94434),u=n(46625),f=n(27378),d=n(31542),h=n(18149),p=n(97306),x=n(25889);let m="adapted__",T="glossary-tooltip-portal-node";function v(){return document.getElementById(T)}function E(e,t){let n=Array.from(e.highlightState.getInnerSentenceHighlights().values());return n.some(e=>e.optimizationMode===t)}function C(e,t){let n=[];if(t){let r=new Set(t.map(e=>e.getId()));for(let[t,a]of e)t.node&&a.some(e=>e.sentence&&r.has(e.sentence.getId()))&&n.push(t.node)}else for(let[t,r]of e)t.node&&n.push(t.node);n.forEach(e=>e._markAsChanged())}l.Z.defineType("/translator/core/highlightManagement",["/translator/core/textareas","/translator/core/paragraphHandling","/translator/core/updateSourceSentences","webTranslatorCore","/translator/environment/localizedTexts","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n,l,S,y)=>{let _=new Map,A=new Map,I=e.getSourceDTextarea(),b=e.getTargetDTextarea(),w=new WeakMap,O=new WeakMap,k=new IntersectionObserver(e=>{e.forEach(e=>{let{isIntersecting:t,target:n}=e,r=w.get(n);if(!r)return;let a=O.get(r);O.set(r,{...a,visible:t}),D(r)})},{threshold:0});function N(e){return C(t.getSourceAlignment(),e),(0,o.wx)("highlightManagement_triggerSourceHighlightUpdate",()=>{I.applyInternalChanges(!1)},0)}function L(e){return C(t.getTargetAlignment(),e),(0,o.wx)("highlightManagement_triggerTargetHighlightUpdate",()=>{b.applyInternalChanges(!1)},0)}function D(e){e instanceof i.t?N([e]):L([e])}function P(t,n,o,i){let C=new Map,y=new Set(n);o.forEach((e,t)=>{y.has(t.node)&&C.set(t,e)}),C.forEach((n,o)=>{let i=o.node;(function(e){if(e.every(e=>""!==e.text))return;let t=e.slice();e.sort((e,n)=>{let r=t.indexOf(e),a=t.indexOf(n);return""===e.text&&""===n.text&&e.paragraphOffset===n.paragraphOffset?a-r:r-a})})(n),n.forEach(n=>{let{sentence:o,text:C,paragraphOffset:y,sentenceOffset:_}=n;if(!o||""===C&&""!==o.getText())return;o instanceof s.Z&&function(e,t,n,o){if(e.highlightState.getInnerSentenceHighlights().forEach((t,n)=>{n.startsWith(m)&&e.highlightState.setInnerSentenceHighlight(n,null)}),!e.highlights||!e.highlights.length)return;let l=()=>{};r||(n.features.with(["/translator/smartEditing/alternativeTranslationsTooltip"],e=>{l=t=>e.isEnabled(t)}),n.features.with(["/translator/web/focusedWordHighlight"],e=>{l=t=>e.enabledTooltipOnHover(t)}));let s=e.getTranslation(),i=s?e.getWhitespacesBefore()+s.getTargetText()+e.getWhitespacesAfter():"",g=new Map;e.highlights.forEach(r=>{var s,u;let{normalizedOffset:m,normalizedLength:E,type:C}=r;if(!g.has(C)){let s=function(e,t,n,r,o,l,s){void 0===s&&(s=!1);let i=e.type;return{classes:[].concat((0,a.Z)(e.classes),["targetHighlightAdapter-module--glossaryHighlightNewTextarea--R8Otw"]),ranges:[],validationMode:c.s.SENTENCE_CONTENT_UNCHANGED,optimizationMode:"none",referenceText:t,eventListeners:{mouseenter:(e,t,a,c)=>{if(s||a[0].getAttachmentNode(i))return;let u=function(){let e=document.createElement("div");return e.style.position="absolute",e.style.top="100%",e.style.left="-8px",e}();a[0].setAttachmentNode(i,u),n.updateTargetTextareaDOM(),function(e,t,n,r,a,o){let{textSource:l,textTarget:s}=e,i=v();i||((i=document.createElement("div")).id=T,i.classList.add("fixed","z-[10000]","w-[200px]","empty:hidden"),document.documentElement.appendChild(i));let c=t.getBoundingClientRect();i.style.left=`${c.x}px`,i.style.top=`${c.y+c.height}px`,function(e,t){var n;let r=e.getBoundingClientRect(),a=null!==(n=t._rootDomNode.closest(".lmt__textarea_container"))&&void 0!==n?n:t._rootDomNode,o=a.getBoundingClientRect();r.right>o.right&&(e.style.transform=`translate(${o.right-r.right}px, 0)`)}(i,a.getTargetDTextarea());let g=n._internalLanguageManagement.getLangAttributeForSelectedSourceLang(),u=n._internalLanguageManagement.getLangAttributeForSelectedTargetLang();d.render(f.createElement(p.L,{value:r},f.createElement(h.j,{textSource:l,textTarget:s,langSource:g,langTarget:u,onHide:o})),i)}(c.customData.tooltipData,u,r,o,n,()=>g(a[0])),l(!1)},mouseleave:(e,t,n)=>{g(n[0])},click:(e,t,n)=>{g(n[0])}}};function g(e){let t=v();t&&d.unmountComponentAtNode(t),e.removeAttachmentNode(i),n.updateTargetTextareaDOM(),l(!0)}}(r,i,t,n,o,l,e.highlightState.getInnerSentenceHighlights().has("targetPopup"));g.set(C,s)}let S=null!==(s=x.ZP.getOffsetForNormalizedOffset(i,m))&&void 0!==s?s:0,y=null!==(u=x.ZP.getOffsetForNormalizedOffset(i,m+E))&&void 0!==u?u:0;g.get(C).ranges.push({offset:S,length:y-S,customData:{tooltipData:r.tooltipData}})}),g.forEach((t,n)=>{e.highlightState.setInnerSentenceHighlight(`${m}${n}`,t)})}(o,e,l,S);let A=o.highlightState.getSentenceHighlights(),I=o.highlightState.getInnerSentenceHighlights();if(0!==A.size||0!==I.size)try{let e=function(e,t,n,r,o,l){let s=Array.from(o).flatMap(e=>{var t;return null!==(t=e[1].classes)&&void 0!==t?t:[]}),i=n.length,c=e.encapsulateContentByOffset(t,r,i,{type:g.$P.INLINE,tag:"span",classes:["sentence_highlight"].concat((0,a.Z)(s)),nonContentNodeType:`sentence_highlight_${l.getId()}`});if(0===c.length)throw Error("Missing sentence node");c.length;let u=c[0];return o.forEach(e=>{e.eventListeners&&Object.entries(e.eventListeners).forEach(e=>{let[t,n]=e;u.addEventListener(t,e=>n(e,[u.getDomNode()],c))})}),u.onDomNodeCreated=(e,t)=>{w.set(e,l),E(l,"visibility")&&k.observe(e),o.forEach(t=>{t.onDomNodeCreated&&t.onDomNodeCreated(e)})},u}(t,i,C,y,A,o);E(o,"hover")&&(e.addEventListener("mouseenter",e=>{let t=O.get(o);O.set(o,{...t,hovered:!0}),D(o)}),e.addEventListener("mouseleave",e=>{let t=O.get(o);O.set(o,{...t,hovered:!1}),D(o)})),I.size>0&&function(e,t,n,r,o){let l=n.keys(),s=t.collectText();for(let f of l){let l=n.get(f),{optimizationMode:d}=l,h=O.get(o);if(("visibility"!==d||(null==h?void 0:h.visible)!==!1)&&("hover"!==d||(null==h?void 0:h.hovered)!==!1))for(let n of l.ranges){let o=function(e,t,n,r){var o;if(void 0===t.referenceText)return{offset:e.offset-r,length:e.length};let l=`${t.referenceText}
`.indexOf("\n",r),s=null===(o=t.referenceText)||void 0===o?void 0:o.substring(r,l);if(s===n)return{offset:e.offset-r,length:e.length};if(t.validationMode===c.s.SENTENCE_CONTENT_UNCHANGED)return null;let{offset:i,length:g}=e,f=function(e,t,n){if(e===t)return(0,a.Z)(n);let r=n.map((t,n)=>({offset1:Math.max(0,Math.min(e.length-1,t)),offset2:void 0,entryIndex:n})),o=(0,a.Z)(r).sort((e,t)=>e.offset1-t.offset1),l=(0,u.Hg)(e,t),s=0,i=0;for(;l.length&&o.length;){let e=l.shift();if(Array.isArray(e)){let[t,n]=e,r=s+t;for(;o.length&&r>o[0].offset1;)o[0].offset2=void 0,o.shift();s=r,i+=n}else{let t=s+e;for(;o.length&&t>o[0].offset1;)o[0].offset2=i+o[0].offset1-s,o.shift();s=t,i+=e}}let c=[];return r.forEach(e=>{c[e.entryIndex]=e.offset2}),c}(t.referenceText,n,g>1?[i,i+g-1]:[i]);if(0===f.length||f.some(e=>void 0===e))return null;if(t.validationMode===c.s.HIGHLIGHT_CONTENT_UNCHANGED){let e=t.referenceText.slice(i,i+g),r=n.slice(f[0],f[1]+1);if(e!==r)return null}return{offset:f[0],length:f[f.length-1]-f[0]+1}}(n,l,s,r);if(o&&o.offset>=0){var i;let r=e.encapsulateContentByOffset(t,o.offset,o.length,{type:g.$P.INLINE,tag:"span",classes:l.classes,nonContentNodeType:null!==(i=l.domNodeReuseId)&&void 0!==i?i:f});l.eventListeners&&r.forEach(e=>{Object.entries(l.eventListeners).forEach(t=>{let[a,o]=t;e.addEventListener(a,e=>{let t=r.map(e=>e.getDomNode()).filter(e=>e);o(e,t,r,n)})})}),l.onDomNodeCreated&&r.forEach(e=>{e.onDomNodeCreated=t=>{l.onDomNodeCreated(t,e,n,o)}}),l.onNodesCreated&&l.onNodesCreated(r,n)}}}}(t,e,I,_,o)}catch(e){}})})}function M(e,t,n){var r;let a=null===(r=n?b:I)||void 0===r?void 0:r._rootDomNode;if(!a)return;let o=n?A:_;if(o.has(e)){let{classes:t}=o.get(e);t.forEach(e=>a.classList.remove(e))}else if(!t)return;t?(o.set(e,t),t.classes.forEach(e=>a.classList.add(e))):o.delete(e)}function R(e,t){var n;return null!==(n=(t?A:_).get(e))&&void 0!==n?n:null}function H(e){var t;let n=null===(t=e?b:I)||void 0===t?void 0:t._rootDomNode;if(!n)return;let r=e?A:_,a=r.keys();for(let e of a){let{classes:t}=r.get(e);t.forEach(e=>n.classList.remove(e)),r.delete(e)}}return I.setFinalizeNodesHandler((e,n,r)=>{P(e,n,t.getSourceAlignment(),!1)}),I.applyInternalChanges(!1),b.setFinalizeNodesHandler((e,n,r)=>{y.ensureTargetSentenceAreUpToDate(),P(e,n,t.getTargetAlignment(),!0)}),b.applyInternalChanges(!1),n.onSourceSentencesChanged.push(()=>{N()}),{notifyTargetSentencesChanged:e=>L(e),notifySourceSentencesChanged:e=>N(e),setGlobalSourceHighlight(e,t){M(e,t,!1)},setGlobalTargetHighlight(e,t){M(e,t,!0)},getGlobalSourceHighlight:e=>R(e,!1),getGlobalTargetHighlight:e=>R(e,!0),clearGlobalSourceHighlights(){H(!1)},clearGlobalTargetHighlights(){H(!0)}}})},80156:function(e,t,n){"use strict";var r=n(61606),a=n(98808),o=n(69748);let l="NO_SELECTION";r.Z.defineType("/translator/core/observeSentenceSelection",["/translator/core/domElements","webTranslatorCore","/translator/core/config","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n,r)=>{let s=(0,a.f)(),i=(0,a.f)(),c=l,g=l,u=n.get("isWriteMode"),{getSourceEditCursorOffset:f,getSourceEditCursorOffsetEnd:d,getTargetEditCursorOffset:h,getTargetEditCursorOffsetEnd:p,sourceEdit:x,targetEdit:m}=e;function T(){let e,n;let a=t.getActiveLangContext();r.ensureTargetSentenceAreUpToDate();let s=h(),c=(0,o.C3)(a,s);if(c){n=`${c.sentenceIndex}_${c.sentenceCursorOffset}`;let t=p();s!==t&&(e=(0,o.C3)(a,t))&&(n+=`:${e.sentenceIndex}_${e.sentenceCursorOffset}`)}else n=l;g!==n&&(g=n,i(c||null,e||null))}function v(){let e,n;let r=t.getActiveLangContext(),a=f(),i=(0,o.c5)(r,a);if(i){n=`${i.sentenceIndex}_${i.sentenceCursorOffset}`;let t=d();a!==t&&(e=(0,o.c5)(r,t))&&(n+=`:${e.sentenceIndex}_${e.sentenceCursorOffset}`)}else n=l;c!==n&&(c=n,s(i||null,e||null))}return document.addEventListener("selectionchange",()=>{let t=e.isSelectionInSourceTextarea(),n=e.isSelectionInTargetTextarea();n?T():t&&v()}),x.addEventListener("keyup",()=>v()),x.addEventListener("click",()=>v()),m.addEventListener("keyup",()=>T()),m.addEventListener("click",()=>T()),x.addEventListener("blur",()=>{c=l,i(null,null),u&&s(null,null)}),m.addEventListener("blur",()=>{g=l,s(null,null),u&&i(null,null)}),{onTargetSelectionChanged:i,onSourceSelectionChanged:s}})},41537:function(e,t,n){"use strict";var r,a=n(4769),o=n(1724),l=n.n(o),s=n(61606),i=n(46625),c=(n(71968),n(25889)),g=n(98808);function u(e,t,n){return e.slice(-n)===t.slice(-n)}function f(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);let o="[alignSentencesAndParagraphs]";if(r&&console.log(o,e),r&&console.log(o,t),0===e.length||0===t.length)return new Map;let s=e.map(e=>e.text),c=t.map(e=>e.getText()),g=function(e,t,n,r){var o,s,c;let g,u,f,m;void 0===n&&(n=null),void 0===r&&(r=!1);let T=l()(e,e=>""!==e);T>=0&&(e=e.slice(0,T+1));let v=function(e,t,n){void 0===n&&(n=!1);let r=[],o=0,l=0,s=0,i=0,c=[];for(;o<e.length&&l<t.length;){let g=e[o],u=t[l],f=Math.min(g.length-s,u.length-i),d=g.substring(s,s+f);if(u.substring(i,i+f)!==d){n&&console.log(`Prefix mismatch found. [${d}] vs. [${u.substring(i,i+f)}]`);break}let h=c[c.length-1];c.push({pIdx:o,sIdx:l,text:d,paragraphOffset:h?h.paragraphOffset+h.text.length:0,sentenceOffset:i}),s+=f,(i+=f)>=u.length&&(n&&console.log("Sentence ",l,"fully consumed"),++l,i=0),s>=g.length&&(""!==t[l]||""===e[o+1])&&(n&&console.log("Paragraph ",o,"fully consumed"),r.push.apply(r,(0,a.Z)(c.splice(0))),++o,s=0)}return n&&console.log("FAST",r),r}(e,t,r),E=v.length?v[v.length-1].pIdx+1:0;if(E===e.length)return v;let C=function(e,t,n){void 0===n&&(n=!1);let r=[],o=e.length-1,l=t.length-1,s=0,i=0,c=[];for(;o>=0&&l>=0;){let g=e[o],u=t[l],f=Math.min(g.length-s,u.length-i),d=g.substring(g.length-s-f,g.length-s),h=u.substring(u.length-i-f,u.length-i);if(h!==d){n&&console.log(`Postfix mismatch found. "${d}" vs. "${h}"`);break}c.push({pIdx:o,sIdx:l,text:d,sentenceOffset:u.length-i-f}),s+=f,i+=f,s>=g.length&&(n&&console.log(`Paragraph #${o} "${g}" fully consumed "`),r.push.apply(r,(0,a.Z)(c.splice(0))),--o,s=0),i>=u.length&&(n&&console.log(`Sentence #${l} "${t[l]}" fully consumed`),--l,i=0)}return r.reverse(),r.forEach((e,t)=>{let n=r[t-1];e.paragraphOffset=(null==n?void 0:n.pIdx)===e.pIdx?n.paragraphOffset+n.text.length:0}),n&&console.log("FAST Reverse",r),r}(e,t,r),S=C.length?e.length-C[0].pIdx:0;r&&console.log("PREFIX",v,E),r&&console.log("POSTFIX",C,S);let y=null===(o=v[v.length-1])||void 0===o?void 0:o.sIdx;if(void 0===y)g=0,u=0;else{let e=0;for(let t=v.length-1;t>=0&&v[t].sIdx===y;--t)e+=v[t].text.length;e===t[y].length?(g=y+1,u=0):(g=y,u=e)}let _=null===(s=C[0])||void 0===s?void 0:s.sIdx;if(void 0===_)f=0,m=0;else{let e=0;for(let t=0;t<C.length&&C[t].sIdx===_;++t)e+=C[t].text.length;e===t[_].length?(f=t.length-_,m=0):(f=t.length-_-1,m=e)}let A=e.slice(E,e.length-S),I=t.slice(g,t.length-f);if(I.length){I[0]=I[0].substring(u);let e=I.length-1,t=I[e];I[e]=t.substring(0,t.length-m)}r&&console.log("CHANGED PARAGRAPHS",A.join(" | "),E,e.length-S-1),r&&console.log("CHANGED SENTENCES",I.join(" | "));let b=Date.now(),w=function(e,t,n,r){void 0===n&&(n=-1),void 0===r&&(r=!1);let a=Date.now(),o=n>=0?a+50:1/0,l=[];for(let t=0;t<e.length;t++)if(l.push(h(e[t])),Date.now()>o)return new x(1);let s=[];for(let e=0;e<t.length;e++)if(s.push(h(t[e])),Date.now()>o)return new x(2);let c=o-Date.now();if(c<=0)return new x(3);let g=(0,i.TY)(l.flat(1),s.flat(1),c);if(!g)return new x(4);r&&console.log("tokensP",l.flat(1)),r&&console.log("tokensS",s.flat(1)),r&&console.log("diff",g);let u=[],f=0,m=0,T=0,v=0;for(let e of g)if(e instanceof Array){let[t,n]=e,r=n>0;for(;t>0;){let e=l[f].length,n=t+T>e?e-T:t;if(0===n)return console.warn("!!!",n),[];u.push({pIdx:f,sIdx:r?m:void 0,text:l[f].slice(T,T+n).join("")}),r=!1,[f,T]=p(l,f,T,n),t-=n}[m,v]=p(s,m,v,n)}else{let t=e;for(;t>0;){let e=l[f].length,n=t+T>e?e-T:t,r=s[m].length,a=t+v>r?r-v:t,o=Math.min(n,a);if(0===o)return console.warn("!!!",n,a),[];u.push({pIdx:f,sIdx:m,text:l[f].slice(T,T+o).join("")}),[m,v]=p(s,m,v,o),[f,T]=p(l,f,T,o),t-=o}}r&&console.log("Alignment:",JSON.stringify(u,null,2));let E=0;for(;u[E];){var C;let e,t;let n=u[E];if(void 0!==n.sIdx){++E;continue}let r=(null===(C=u[E-1])||void 0===C?void 0:C.pIdx)===n.pIdx?u[E-1]:void 0,a=[n];for(let t=E+1;u[t]&&u[t].pIdx===n.pIdx;++t){if(void 0!==u[t].sIdx){e=u[t];break}a.push(u[t])}E+=a.length,(r||e)&&(t=!r&&e?e.sIdx:r&&!e?r.sIdx:r.sIdx===e.sIdx?r.sIdx:r.text.match(/([.!?)]\s|[？。．！]\s*)$/)?e.sIdx:r.sIdx),void 0!==t&&a.forEach(e=>{e.sIdx=t})}let S=[];if(u.forEach(e=>{let t=S[S.length-1];(null==t?void 0:t.pIdx)===e.pIdx&&(null==t?void 0:t.sIdx)===e.sIdx?t.text+=e.text:S.push(e)}),S.length&&void 0!==S[0].sIdx){let e="";for(let n=0;n<S.length;++n){let r=S[n];if(void 0===r.sIdx){r.isGuessedMatch=!0,e="";continue}let a=S[n+1];if(e+=r.text,!a||a.sIdx!==r.sIdx){if(e!==t[r.sIdx])for(let e=n;e>=0&&S[e].sIdx===r.sIdx;--e)S[e].isGuessedMatch=!0;e=""}}}else S.length&&(S[0].isGuessedMatch=!0);return d(S),r&&console.log("Merged alignments:",JSON.stringify(S,null,2)),S}(A,I,50);if(w instanceof x){let e=w.step;w=function(e,t){let n=[],r=0;for(let e=0;e<t.length;e++)n.push({sIdx:e,pIdx:0,paragraphOffset:0,sentenceOffset:r,text:t[e],isGuessedMatch:!0}),r+=t[e].length;for(let r=1;r<e.length;r++)n.push({sIdx:t.length-1,pIdx:r,paragraphOffset:0,sentenceOffset:0,text:"",isGuessedMatch:!0});return n}(A,I),r&&console.log("DetailedAlign timeout detected"),null===(c=n)||void 0===c||c({step:e,time:Date.now()-b})}if(w.forEach(e=>{e.pIdx+=E,void 0!==e.sIdx&&(e.sIdx+=g)}),w.length>0){if(u>0&&w[0].isGuessedMatch){let e=w[0].sIdx;for(let t=v.length-1;t>=0&&v[t].sIdx===e;--t)v[t].isGuessedMatch=!0}if(m>0&&w[w.length-1].isGuessedMatch){let e=w[w.length-1].sIdx;for(let t=0;t<C.length&&C[t].sIdx===e;++t)C[t].isGuessedMatch=!0}if(u>0&&!w[0].isGuessedMatch){let e=v[v.length-1].sIdx,t=v[v.length-1].text.length;for(let n=0;n<w.length&&w[n].sIdx===e;++n)w[n].sentenceOffset+=t}}let O=[].concat((0,a.Z)(v),(0,a.Z)(w),C);return d(O),O}(s,c,n,r),u=new Map,f=[];return e.forEach(e=>{let t=[];f.push(t),u.set(e,t)}),g.forEach(e=>{f[e.pIdx].push({sentence:void 0!==e.sIdx?t[e.sIdx]:void 0,text:e.text,paragraphOffset:e.paragraphOffset,isGuessedMatch:!!e.isGuessedMatch,...void 0!==e.sentenceOffset&&{sentenceOffset:e.sentenceOffset}})}),u}function d(e){e.forEach((t,n)=>{let r=e[n-1];t.paragraphOffset=(null==r?void 0:r.pIdx)===t.pIdx?r.paragraphOffset+r.text.length:0,r?t.sentenceOffset=r.sIdx===t.sIdx?r.sentenceOffset+r.text.length:0:t.sentenceOffset=0})}function h(e){return e.match(c.cc)}function p(e,t,n,r){let a=t,o=r+n;for(;a<e.length-1&&e[a].length<=o;)o-=e[a].length,++a;return[a,o]}s.Z.defineType("/translator/core/paragraphHandling",["/translator/core/textareas","/translator/core/languageManagement","/translator/core/config"],(e,t,n)=>{let r=(0,g.f)();return{getSourceAlignment(){let a=t.getActiveLangContext(),o=e.getSourceParagraphs(),l=a.getSourceSentences();return f(o=function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r=20);let a=[],o=0,l=t,s=e.map(e=>e.text).join("");if(s.length<=t)return e;if(n){let e=n.map(e=>e.getText()).join("");if(!u(s.substring(0,t),e,r)){let n=function(e,t){for(let n=1;n<=e;n++){if(t(n))return n;if(t(-n))return-n}return null}(r,n=>u(s.substring(0,t+n),e,r));null!=n&&(l=t+n)}}for(let t of e){if(o>=l)break;a.push({...t,text:t.text.slice(0,l-o)}),o+=t.text.length}return a}(o,n.get("CONFIG__MAX_NUM_CHARACTERS"),l),l,r)},getTargetAlignment(){let n=t.getActiveLangContext(),a=e.getTargetParagraphs();return f(a,n.getTargetSentences(),r)},onDetailedAlignTimedOut:r}});let x=function(e){this.step=e};void 0===r&&(r=!1)},54693:function(e,t,n){"use strict";var r=n(61606),a=n(69748),o=n(22496),l=n(98808),s=n(58462);r.Z.defineType("/translator/smartEditing/detectTargetSentenceClicks",["/translator/core/domElements","/translator/core/languageManagement","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n)=>{let{targetEdit:r,getTargetEditCursorOffset:i,getTargetEditCursorOffsetEnd:c}=e,{getActiveLangContext:g}=t,u=(0,l.f)(),f=(0,l.f)();return r.addEventListener("click",e=>{let{detail:t,target:l}=e;if(!(r instanceof HTMLTextAreaElement)&&l===r.dTextarea._rootDomNode){f();return}!function(e){let t=g(),l=r.value;n.ensureTargetSentenceAreUpToDate();let d=i(),h=c(),p=l.substring(d,h).trim();if(-1!==p.indexOf(" ")){(o.ZP.isWin||o.ZP.isMac)&&!o.ZP.isMobilePhone&&u({langContext:t,tSentenceWordPos:void 0,tSentenceCursorPos:void 0,trigger:"click",clickNumber:e});return}let x=(0,s.PY)(l,d),m=(0,a.C3)(t,x),T=(0,a.C3)(t,d);if(m){if(0===l.substring(d-1,h+1).trim().length&&m.sentence.getText().trim().length){f();return}let e=(0,s.DO)(r,x);if(e.top<=0&&e.left<=0&&x>0)return}u({langContext:t,tSentenceWordPos:null!=m?m:void 0,tSentenceCursorPos:null!=T?T:void 0,trigger:"click",clickNumber:e})}(t)}),{onTargetSentenceClicked:u,onEmptyAreaClicked:f,triggerTargetSentenceClicked:e=>{u(e)}}})},724:function(e,t,n){"use strict";n.d(t,{Oc:function(){return o},TL:function(){return i},XJ:function(){return s},pf:function(){return l}});var r=n(10878),a=n(46237);function o(e,t,n){void 0===n&&(n=!1);let r=[];n&&console.log("existingPostfix:",e," got entries: ",t);let a=-1,o=-1,l=0;return t.forEach(t=>{let{postfix:n}=t;if(!n.trim().length)return;let s=e.startsWith(n)?n.length:0;s>o&&s>0&&(a=l,o=s),r.push(t),l+=1}),o>=0&&a>=0&&r.splice(a,1),r}function l(e,t,n){return void 0===n&&(n=!1),!!(t<e.length&&(e.charAt(t).match(r.K$)||n))}function s(e,t){let n=e.getTranslation();if(!n)throw new a.x("smartTargetEditing.helpers no translation");let[r,o]=e.getNormalizedTextAndOffset(t),l=r.substring(0,o),s=l.length,i=r.substr(o);return{normalizedText:r,normalizedSentenceCursorOffset:o,prefix:l,prefixLength:s,existingPostfix:i}}function i(e,t){let n=t.prefix.trim(),r=e.getLastFullTrimmedText(),a=n.substr(n.length-5)===r.substr(r.length-5);return 0===t.existingPostfix.trim().length&&r.length>3&&!!a}},69667:function(e,t,n){"use strict";var r=n(30171),a=n(61606),o=n(98808);a.Z.defineType("/translator/smartEditing/smartTargetEditing",["/translator/core/domElements","webTranslatorCore","/translator/core/networkStatus","/translator/smartEditing/smartTargetEditingUpdateTarget","/translator/smartEditing/smartTargetEditingDetector"],(e,t,n,a,l)=>{let s=(0,o.f)(),i=(0,o.f)(),c=(0,o.f)(),g=(0,o.f)(),u=(0,o.f)(),f=(0,o.f)(),d=(0,o.f)(),h=(0,o.f)(),p=(0,r.S3)(void 0),x=(0,r.G7)([p],e=>void 0!==e),m=(0,r.S3)("source");function T(e){p(e),u(e),e.data.isComplete&&g(e)}function v(e,t){let n=p();if(!n)return;let r={...n,globalCursor:e,sentenceCursor:t};p(r)}function E(e){let t=p();if(!t)return;let n={...t,data:e};p(n),n.data.isComplete&&g(n)}function C(){x()&&(p(void 0),f())}async function S(r,o,l,g,u){let{targetEdit:f}=e,d="autocompletion"===r,h=g.prefix||"",p=g.displayPostfix,x=t.getActiveLangContext();if(c({index:u,isAutoCompletion:d}),C(),!o)return;let m=o.getNormalizedText();try{await a.applyAlternativeOrAutocomplete(x,o,h,g.postfix,!d);let e=l+g.postfix.length;f.setSelectionRange(e,e),d?i({targetTextBefore:m,targetTextAfter:o.getNormalizedText()}):s({sourceSentence:o.getSourceSentence(),targetPrefix:h,targetTextBefore:m,targetTextAfter:o.getNormalizedText(),targetSentence:o,chosenAlternative:p})}catch(e){console.trace(e),n.onRequestFailed("fillUp",e instanceof Error?e:Error(String(e)))}}return l.onStopSmartEditing.push(()=>{C()}),{onTargetSentenceChangedByAlternative:s,onTargetSentenceChangedByAutocompletion:i,onSuggestionItemActive:d,onSuggestionItemInactive:h,onUserSelectsAlternative:c,onUserEditPerformed:a.onUserEditPerformed,onTargetPopupOpened:g,onTargetPopupOpening:u,onTargetPopupClosed:f,isPopupOpen:x,targetPopupInfo:p,closePopup:C,openPopup:T,updatePopupPrimaryData:E,updatePopupSecondaryData:function(e){let t=p();if(!t)return;let n={...t,dataSecondary:e};p(n)},updatePopupAnchor:v,openOrUpdate:function(e){let{popupInfo:t,hasCursorInfoChanged:n}=e;x()?(E(t.data),n&&v(t.globalCursor,t.sentenceCursor)):T(t)},applyAlternative:S,sentenceAlternativeMode:m}})},57249:function(e,t,n){"use strict";n.d(t,{BH:function(){return o},J3:function(){return s},ME:function(){return a},NH:function(){return l}});var r=n(724);function a(e){var t;let{langContext:n,tSentenceWordPos:r,tSentenceCursorPos:a}=e,o=n.areWordsWrittenContinuously()?a:r;if(!o)return null;let l=o.sentence,s=o.sentenceCursorOffset,i=l.getTranslation(),c=null!==(t=null==i?void 0:i.getSourceText())&&void 0!==t?t:"",[g,u]=l.getNormalizedTextAndOffset(s),f=g.substr(0,u);return{rawEnSentence:c,deSentenceBeginning:f}}function o(e,t){return!!e&&!!t&&e.deSentenceBeginning===t.deSentenceBeginning&&e.rawEnSentence===t.rawEnSentence}function l(e){let{clickInfo:t,isSameClickPositionAsBefore:n,isPopupOpen:a,isActiveLangContext:o,showAlternativesOnEveryClick:l}=e,{langContext:s,tSentenceWordPos:i,tSentenceCursorPos:c,clickNumber:g}=t;if(!i&&o)return!1;let u=s.areWordsWrittenContinuously()?c:i;if(!u)return!1;let f=!l&&a,d=u.sentence,h=u.sentenceCursorOffset,p=!(0,r.pf)(d.getText(),h,s.areWordsWrittenContinuously());return(void 0===g||!(g>=3)&&(!f||1!==g))&&(!f&&!p&&!n||2===g)&&!!o}function s(e,t,n){let r={...e,data:{type:"alternatives",isComplete:!0,entries:n||[],error:!1},dataSecondary:void 0},a=!1;if(t){var o,l;let e=(null===(o=n[0])||void 0===o?void 0:null===(l=o.prefix)||void 0===l?void 0:l.length)||0,t=r.globalCursor-(r.sentenceCursor-e);t!==r.globalCursor&&(r.globalCursor=t,r.sentenceCursor=e,a=!0)}return{popupInfo:r,hasCursorInfoChanged:a}}},41466:function(e,t,n){"use strict";var r=n(30171),a=n(61606),o=n(10878),l=n(69748),s=n(58425),i=n(724),c=n(46237);a.Z.defineType("/translator/smartEditing/smartTargetEditingAlternativesCommunication",["/translator/globalState","/translator/webTranslatorCore","/translator/core/languageManagement","/translator/core/domElements","/translator/core/requestHandling","/translator/smartEditing/smartTargetEditing","/translator/smartEditing/smartTargetEditingCommunication"],(e,t,n,a,g,u,f)=>{let d=(0,r.S3)(h());function h(){let t=n.getActiveLangContext();return t.isSmartTargetEditingAvailable()&&!e[o.AL]()&&!0!==a.targetEdit.disabled}async function p(e,r,a,o){let s="[requestAlternativesForPopup]";if(void 0===r)throw new c.x(`${s} targetSentence is undefined`);if(!t.isActiveLangContext(e))throw new c.x(`${s} state is not active`);let g=(0,i.XJ)(r,a);if((0,i.TL)(r,g))return[];let u=r.getSourceSentence(),d=u&&"source"===o?(0,l.rU)(u):(0,l.Ci)(r,n.getActiveLangContext().getTargetSentences()),h=r.getTranslation();if(!h)throw new c.x(`${s} no translation`);return f.fetchAlternatives(e,d,h,g,r.getRephraseVariant())}let x={latestRequestContextId:(0,r.S3)(-1),_tDelay:null};async function m(e){let{langContext:t,targetSentence:n,sentenceCursor:r,onShowLoading:a}=e,o=g.startRequestContext(t,s.Xk.TYPE__SMART_EDIT_REQUEST);x.latestRequestContextId(o._id),x._tDelay=setTimeout(()=>{a()},50);try{let e=await p(t,n,r,u.sentenceAlternativeMode());if(x._tDelay&&(clearTimeout(x._tDelay),x._tDelay=null),o.stop(),o._id!==x.latestRequestContextId())return"stale";return e}catch(e){throw o.stop(),e}}return!function(){let e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"disabled"===e.attributeName&&d(h())})});e.observe(a.targetEdit,{attributes:!0}),n.onActiveLangContextChanged.push(()=>{d(h())}),u.onTargetPopupClosed.push(()=>{x.latestRequestContextId(-1)})}(),{isSmartTargetEditingSupported:d,requestAlternatives:m}})},87543:function(e,t,n){"use strict";var r=n(61606),a=n(58462),o=n(69748),l=n(10878);r.Z.defineType("/translator/smartEditing/smartTargetEditingAutocompletion",["globalState","/translator/core/domElements","/translator/core/languageManagement","webTranslatorCore","/translator/core/textareas","/translator/smartEditing/smartTargetEditing","/translator/smartEditing/smartTargetEditingCommunication","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n,r,s,i,c,g)=>{let{getTargetEditCursorOffset:u}=t,f=0;async function d(){let e=r.getActiveLangContext();if(!e.isSmartTargetEditingAvailable()||!e.isAutocompletionAvailable())return;let t=u(),s=(0,o.C3)(e,t);if(!s)return;let g=s.sentence,d=s.sentenceCursorOffset,[h,p]=g.getNormalizedTextAndOffset(d),x=h.substr(0,p),m=g.getTranslation();if(!m||g.getLastFullTrimmedText()&&x.startsWith(g.getLastFullTrimmedText().trim()))return;f+=1;let T=f,v=await c.fetchAutocompletionData(e,g,m,x);if(v&&!(T<f)&&(s=(0,o.C3)(e,t))&&s.sentence===g){if(!s)return;let t="",r=g.getText(),o=s.sentenceCursorOffset;if(o>0)for(o-=1;o>=0&&!r.charAt(o).match(l.hJ);)t=r.charAt(o)+t,o-=1,s.sentenceCursorOffset-=1,s.cursorOffset-=1;let{translations:c}=v,u=((c||[])[0]||[]).beams||[],f=x.trimStart().length,d=[];if(u.length){let n=u[0],r=(0,a.x8)(n),o=r.substr(f),l=t+o;if(""!==o&&l.trim().length){let n=x.substr(0,x.length-t.length),a={displayPostfix:l,postfix:l,cursorOffset:e.areWordsWrittenContinuously()?n.length:0,prefix:n};d.push(a);let o=[x,r,v];g.cachedAutocompletionRequests.some(e=>e[0]===o[0]&&e[1]===o[1])||g.cachedAutocompletionRequests.push(o)}}if(d.length&&d.length>0){let e={targetSentence:g,sentenceCursor:s.sentenceCursorOffset,globalCursor:s.cursorOffset,trigger:"autocompletion",data:{type:"autocompletion",isComplete:!0,entries:d,error:!1},dataSecondary:void 0,targetLang:n.getSelectedTargetLangSettings()};i.openPopup(e)}else i.closePopup()}}t.onTargetEditKeyUp.push(t=>{let{event:n,info:r}=t;if(n.keyCode===a.nG);else if(n.keyCode===a.Fc||n.keyCode===a.rC||n.keyCode===a.FD||n.keyCode===a.Dx||n.keyCode===a.D$||n.keyCode===a.$g);else if(n.keyCode>=15&&n.keyCode<32||224===n.keyCode||n.keyCode===a.iP||n.keyCode===a.$v||n.keyCode===a.ux||n.keyCode===a.V7);else{var o;g.ensureTargetSentenceAreUpToDate(),e[l.AL]()||n.keyCode===a.Im||n.keyCode===a.yM||n.keyCode===a.WF||n.keyCode===a.gK||(n.keyCode===a.kV||n.keyCode===a.sQ)&&" ">s.getTargetText().charAt(u())||null!==(o=r.keyDownEvent)&&void 0!==o&&o.ctrlKey||n.ctrlKey||r.keyDownEvent&&d()}})})},61784:function(e,t,n){"use strict";var r=n(98808),a=n(77396),o=n(67974),l=n(61606),s=n(41941),i=n(46237),c=n(69748),g=n(58425),u=n(724),f=n(58462),d=n(30171),h=n(69496);l.Z.defineType("/translator/smartEditing/smartTargetEditingCommunication",["webTranslatorCore","/translator/core/config","/translator/core/translationBackend","/translator/core/networkStatus","/translator/core/requestHandling"],(e,t,n,l,p)=>{let x=(0,r.f)(),m=t.get("disableCaches"),T=t.get("isWriteMode"),v=t.get("isRtfEnabled"),E=(0,r.f)(),C=(0,r.f)();function S(e,t,n){let r={kind:e,sentences:[{text:t,id:0,prefix:"",partial_translation:n}]};return x(r),r}return{fetchAlternatives:function(e,t,r,a,o){let{existingPostfix:i}=a;if(!m){let t=r.getCachedLocalAlternativeEntries(a.prefix);if(t){var c;if(e.areWordsWrittenContinuously()){let e=t[0].cursorOffset;i=a.normalizedText.substring(e)}return c=(0,u.Oc)(i,t),new Promise(e=>{setTimeout(()=>e(c),0)})}}let g=S(s.Z.JOB_KIND__ALTERNATIVES_AT_POSITION,r.getSourceText(),a.prefix);if(T&&(g.rephrase_variant=o,g.rephrase_variant||(g.write_variant_requests=["main"]),g.rephrase_variant),e.areWordsWrittenContinuously()&&(delete g.sentences[0].partial_translation,g.sentences[0].complete_translation=a.normalizedText,g.sentences[0].cursor_offset=a.normalizedSentenceCursorOffset,a.normalizedText.length-1<a.normalizedSentenceCursorOffset&&(g.sentences[0].cursor_offset=a.normalizedText.length-1),g.sentences[0].cursor_offset<0))return Promise.resolve([]);e.isContextEnabled()&&t&&(g.raw_en_context_before=t.prefix,g.raw_en_context_after=t.postfix);let d=e.createJobSettings();return"richtext"===d.commonJobParams.textType&&(d.commonJobParams.textType="plaintext"),n.sendTranslationJobs([g],d,!1).then(t=>{let{translations:n}=t,o=((n||[])[0]||[]).beams||[],l=[];o.forEach(t=>{let n=t.sentences&&t.sentences[0]&&t.sentences[0].prefix_offset||0,r=a.prefixLength,o=a.prefix;e.areWordsWrittenContinuously()&&(a.prefix.trim(),r=n,o=a.prefix.substring(0,r).trim(),i=a.normalizedText.substring(n));let s=(0,f.x8)(t);if(!s)return;let c=null==s?void 0:s.substring(0,r);if(o.trim()!==(null==c?void 0:c.trim())){console.warn("[fetchAlternatives]",`req.Prefix does not match
              received [${c}]
              expected [${o}]`);return}let g=null==s?void 0:s.substring(r),u={displayPostfix:`${g} ...`,postfix:g,prefix:o,rephraseVariant:t.rephrase_variant,cursorOffset:n};l.push(u)}),r.setCachedLocalAlternativeEntries(a.prefix,l);let s=(0,u.Oc)(i,l);return s},e=>{throw l.onRequestFailed("alternatives",e),e})},fetchAutocompletionData:async function(t,r,u,f){let d=(0,a.$)();try{let a=await (0,o.AV)(`fetchAutocompletionData_${t.getId()}`,async()=>{var a,o;let l;if(!e.isActiveLangContext(t))throw new i.x("[autocompletion] lang context not available");let h=p.startRequestContext(t,g.Xk.TYPE__SMART_EDIT_REQUEST);d.push(()=>h.stop());let x=r.cachedAutocompletionRequests.slice(0),T=null===(a=r.getTranslation())||void 0===a?void 0:a.getTranslationResult();if(T){let e={beams:[{sentences:[{text:T.beams[0].sentences[0].text}]}]};x.push(["",null===(o=r.getTranslation())||void 0===o?void 0:o.getTargetText(),{translations:e}])}if(x.some(e=>{let[t,n,r]=e;return!!(f.startsWith(t)&&n.startsWith(f))&&(l=r,!0)}),!m&&l)return l;let v=S(s.Z.JOB_KIND__AUTOCOMPLETION,u.getSourceText(),f);if(v.preferred_num_beams=1,t.isContextEnabled()){let e=r.getSourceSentence();if(e){let t=(0,c.rU)(e);v.raw_en_context_before=t.prefix,v.raw_en_context_after=t.postfix}}return n.sendTranslationJobs([v],t.createJobSettings(),!1)},1e3);return d(),a}catch(e){d(),e===o.AV.FAILURE_REASON__CANCELED||e===o.AV.FAILURE_REASON__TIMEOUT||l.onRequestFailed("autocompletion",e instanceof Error?e:Error(String(e)));return}},fetchFillUpTargetSentence:async function(e,t,r,a){let o=null!=a?a:t.getNormalizedTextAndOffset(0)[0],l=(t.getParts(),t.getTranslation());if(!l)return r?t.getHtml().getOuter():t.getText();let i=(0,d.S3)(r?l.getSourceHtml():l.getSourceText()),u=(0,d.S3)(o);E(t,i,u);let h=S(s.Z.JOB_KIND__DEFAULT,i(),u());if(h.preferred_num_beams=1,e.isContextEnabled()){let e=t.getSourceSentence();if(e){let t=(0,c.rU)(e);h.raw_en_context_before=t.prefix,h.raw_en_context_after=t.postfix}}T&&(h.rephrase_variant=t.getRephraseVariant(),h.rephrase_variant||(h.write_variant_requests=["main"]));let x=p.startRequestContext(e,g.Xk.TYPE__SMART_EDIT_REQUEST);try{let a=await n.sendTranslationJobs([h],e.createJobSettings(),!0);x.stop();let o=a.translations[0].beams,l=(0,d.S3)();if(o.length){let e=(0,f.x8)(o[0]);l(e)}else console.log("request_fillUpTargetSentence: No Result found"),l(r?t.getHtml().getInnerContent():t.getInnerText());return C(t,l),l()}catch(e){throw x.stop(),e}},fetchWriteSentenceAlternatives:async function(e,t){let r=v?t.html:t.text,a=S(s.Z.JOB_KIND__DEFAULT,r,"");a.write_variant_requests=["main","variants"];let o=e.createJobSettings();e.isContextEnabled()&&(a.raw_en_context_before=t.prefix,a.raw_en_context_after=t.postfix);try{var i,c;let e=await n.sendTranslationJobs([a],o,!1);if((null!==(i=null==e?void 0:null===(c=e.translations)||void 0===c?void 0:c.length)&&void 0!==i?i:0)===0){console.warn("invalid response when fetching sentence alternatives");return}let t=e.translations[0],r=t.beams.map(e=>{let t=e.sentences[0].text,n=v?(0,h.Sl)(t):t,r=v?t:(0,h.p$)(t);return{text:n,html:r,rephraseVariant:e.rephrase_variant}});return r}catch(t){let e=t instanceof Error?t:Error(String(t));throw l.onRequestFailed("alternatives",e),e}},onJobPrepared:x,onBeforeFillupRequest:E,onAfterFillupRequest:C}})},82961:function(e,t,n){"use strict";var r=n(61606),a=n(98808),o=n(10878),l=n(58462),s=n(67974),i=n(69748);r.Z.defineType("/translator/smartEditing/smartTargetEditingDetector",["globalState","/translator/core/domElements","webTranslatorCore","/translator/core/textareas","/translator/smartEditing/detectTargetSentenceClicks","/translator/core/translateSourceSentences","/translator/core/networkStatus","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n,r,c,g,u,f)=>{let d=(0,a.f)(),h=(0,a.f)(),p=(0,a.f)(),{getTargetEditCursorOffset:x,targetEdit:m,sourceEdit:T,targetEditInnerContainer:v}=t;return T.addEventListener("focus",()=>p()),[v,m].forEach(e=>null==e?void 0:e.addEventListener("scroll",()=>p())),c.onEmptyAreaClicked.push(()=>p()),u.onRequestFailed.push((e,t)=>p()),g.onTargetSentencesHaveChanged.push(e=>p()),c.onTargetSentenceClicked.push(e=>{let{langContext:t,tSentenceWordPos:n,tSentenceCursorPos:r,trigger:a,clickNumber:o}=e;d({langContext:t,tSentenceWordPos:n,tSentenceCursorPos:r,trigger:a,clickNumber:o})}),t.onTargetEditKeyUp.push(a=>{var c,g;let{event:u,info:T}=a;function v(){let e=n.getActiveLangContext(),t=r.getTargetText();f.ensureTargetSentenceAreUpToDate();let a=x(),o=(0,l.PY)(t,a),s=(0,i.C3)(e,o),c=(0,i.C3)(e,a);d({langContext:e,tSentenceWordPos:null!=s?s:void 0,tSentenceCursorPos:null!=c?c:void 0,trigger:"key"})}!(null!==(c=m.dTextarea)&&void 0!==c&&c.isCompositionInProgress())&&(u.keyCode===l.nG?v():u.keyCode===l.Fc||u.keyCode===l.rC||u.keyCode===l.FD||u.keyCode===l.Dx||u.keyCode===l.D$||u.keyCode===l.$g?(p(),(0,s.wx)("triggerOnSuggestions",()=>{(function(){if(t.isSelectionInTargetTextarea()){let e=x(),t=r.getTargetText().charAt(e-1),n=r.getTargetText().charAt(e);if((0===e||"\n"===t||" "===t)&&" "!==n&&"\n"!==n)return!0}return!1})()&&v()},300)):u.keyCode>=15&&u.keyCode<32||224===u.keyCode||u.keyCode===l.iP||u.keyCode===l.$v||u.keyCode===l.ux||u.keyCode===l.V7||(f.ensureTargetSentenceAreUpToDate(),e[o.AL]()||u.keyCode===l.Im||u.keyCode===l.yM||u.keyCode===l.WF||u.keyCode===l.gK||(u.keyCode===l.kV||u.keyCode===l.sQ)&&" ">r.getTargetText().charAt(x())||null!==(g=T.keyDownEvent)&&void 0!==g&&g.ctrlKey||u.ctrlKey||T.keyDownEvent&&h()))}),{onAlternatives:d,onAutocompletion:h,onStopSmartEditing:p}})},44821:function(e,t,n){"use strict";var r=n(61606),a=n(98808),o=n(82736),l=n(67977),s=n(69496);let i="smartEditing/fill-up-request";r.Z.defineType("/translator/smartEditing/smartTargetEditingUpdateTarget",["/translator/core/languageManagement","/translator/core/textareas","/translator/smartEditing/smartTargetEditingCommunication","/translator/core/config"],(e,t,n,r)=>{let c=(0,a.f)(),g=t.getTargetDTextarea(),u=r.get("isRtfEnabled");function f(n){if(e.isActiveLangContext(n)){if(u){let e=o.Z.getJoinedHtml(n.targetSentences);t.updateTargetHtml(e)}else{let e=o.Z.getJoinedText(n.targetSentences);t.updateTargetText(e)}}}return{applyAlternativeOrAutocomplete:async function(e,t,r,a,o){let d=t.getText().substr(r.length).match(/\s*$/)[0],h=t.getWhitespacesBefore();if(l.W4.countStats("e",e=>e+1,0),o){d||(d=" ",t.postfixWhitespaceIsTemporary=!0),t.updateRawText(h+r+a+d,!1,!0),u&&t.updateHtmlFromText(),f(e),null==g||g.lockUndoStack(i,5e3),t.updateRawText(r+a,!1,!0),u&&t.updateHtmlFromText(),c({state:e,targetSentence:t,type:"EDIT_TYPE__SELECT_ALTERNATIVE_FIRST_STEP"});let o=await n.fetchFillUpTargetSentence(e,t,u),l=d;if(t.postfixWhitespaceIsTemporary&&(l="",t.postfixWhitespaceIsTemporary=!1),u){let e=(0,s.Sl)(o);t.updateRawText(h+e+l,!0,!0),t.getHtml().updateOuter((0,s.p$)(h),o,(0,s.p$)(l))}else t.updateRawText(h+o+l,!0,!0);f(e),null==g||g.unlockUndoStack(i),c({state:e,targetSentence:t,type:"EDIT_TYPE__SELECT_ALTERNATIVE"})}else{let n=r+a+d;t.updateRawText(n,!0,!0),u&&t.updateHtmlFromText(),f(e),c({state:e,targetSentence:t,type:"EDIT_TYPE__AUTOCOMPLETION"})}},onUserEditPerformed:c,updateTargetEditFromState:f}})},46237:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var r=n(93219);let a=function(e){function t(t){var n;return(n=e.call(this)||this).msg=void 0,n.msg=t,n}return(0,r.Z)(t,e),t}((0,n(90434).Z)(Error))},56819:function(e,t,n){"use strict";var r=n(61606),a=n(25889),o=n(84627);let l="updateTargetSentencesFromText";r.Z.defineType("/translator/smartEditing/updateTargetSentencesFromText",["/translator/core/languageManagement","/translator/core/config","/translator/core/textareas","/translator/core/richTextHandling"],(e,t,n,r)=>{let s=(0,o.fo)(),g="";return{ensureTargetSentenceAreUpToDate:function(){var o,u;let f=e.getActiveLangContext(),d=t.get("isRtfEnabled"),h=d?null!==(o=null===(u=n.getTargetDTextarea())||void 0===u?void 0:u.getHtml())&&void 0!==o?o:"":n.getTargetText();if(g===h)return;g=h;let p=n.getTargetText();if(function(e,t,n){let r,o;let s=a.ZP.splitTextIntoParts(t),g=e.targetSentences.slice(0);{let e=g[0];for(;e;){let t,n;let a=e.getParts(),o=0,l=0,u=!1;for(;;){for(n=a[l];n&&n.isWhitespacePart;)l+=1,n=a[l];for(t=s[o];t&&t.isWhitespacePart;)o+=1,t=s[o];if(!n){u=!0;break}if(!t||t.text!==n.text)break;o+=1,l+=1}if(u){let t=s.splice(0,o);if(t.length){let e=t[t.length-1];if(e.isWhitespacePart){let t=i(e.text);e.text=t[0],t[1].length&&s.unshift({text:t[1],isWhitespacePart:!0})}}let n=[];t.forEach(e=>n.push(e.text)),c(e,n,!1),r=e,g.shift(),e=g[0]}else break}}{let e=g[g.length-1];for(;e;){let t,n;let r=e.getParts(),a=s.length-1,l=r.length-1,u=!1;for(;;){for(n=r[l];n&&n.isWhitespacePart;)l-=1,n=r[l];for(t=s[a];t&&t.isWhitespacePart;)a-=1,t=s[a];if(!n){u=!0;break}if(!t||t.text!==n.text)break;a-=1,l-=1}if(u){let t=s.splice(a+1);if(t.length){let e=t[0];if(e.isWhitespacePart){let t=i(e.text);e.text=t[1],t[0].length&&s.push({text:t[0],isWhitespacePart:!0})}}let n=[];t.forEach(e=>n.push(e.text)),c(e,n,!1),o=e,g.pop(),e=g[g.length-1]}else break}}let u=s.reduce((e,t)=>{var n;return null!==(n=e+t.text)&&void 0!==n?n:""},"");if(""!==u&&n({remainingText:u,remainingTargetSentences:g}),1===g.length&&s.length){let e=g.shift(),t=[];s.splice(0).forEach(e=>t.push(e.text)),c(e,t,!0)}else if(!g.length&&s.length){let e=0;if(r||o){if(r&&!o)e=-1;else if(!r&&o)e=1;else{var f;e=null!==(f=r)&&void 0!==f&&f.getText().match(/(\n|[!?])\s*$/)?1:-1}}if(e>0){let e=[];s.splice(0).reverse().forEach(t=>e.unshift(t.text)),e.push(o.getText()),c(o,e,!0)}else if(e<0){let e=[r.getText()];s.splice(0).forEach(t=>e.push(t.text)),c(r,e,!0)}}else if(g.length&&s.length){console.warn(l,"Alignment is lost (ambiguous match).");let e=[];s.splice(0).forEach(t=>e.push(t.text));let t=g.shift();c(t,e,!0),g.forEach(e=>{c(e,[""],!0)})}else g.length>=1&&0===s.length&&(console.warn(l,"Alignment is lost (removed)."),g.forEach(e=>{c(e,[""],!0)}))}(f,p,s),d){let e=n.getTargetTextareaSnapshot();r.updateTargetSentencesHtml(f.targetSentences,e)}},onUpdateTargetSentencesChanged:s}});let s=/^(\s*\n)(\s*)$|^(\s*)$/;function i(e){let t=e.match(s);return t?t[1]?[t[1],t[2]]:[t[3],""]:["",e]}function c(e,t,n){let r=e.getParts();if(r.length){t[0]!==r[0].text&&(r[0].isWhitespacePart||t[0].match(/^\s+$/))&&e.updateWhitespacesBeforeRev();let n=r[r.length-1],a=t[t.length-1];a!==n.text&&(n.isWhitespacePart||a.match(/^\s+$/))&&e.updateWhitespacesAfterRev()}e.updateRawText(t.join(""),!1,n)}},95372:function(e){e.exports=function(e,t,n,r){for(var a=e.length,o=n+(r?1:-1);r?o--:++o<a;)if(t(e[o],o,e))return o;return -1}},1724:function(e,t,n){var r=n(95372),a=n(89278),o=n(47991),l=Math.max,s=Math.min;e.exports=function(e,t,n){var i=null==e?0:e.length;if(!i)return -1;var c=i-1;return void 0!==n&&(c=o(n),c=n<0?l(i+c,0):s(c,i-1)),r(e,a(t,3),c,!0)}},94919:function(e,t,n){var r=n(91936),a=1/0;e.exports=function(e){return e?(e=r(e))===a||e===-a?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0}},47991:function(e,t,n){var r=n(94919);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}}}]);